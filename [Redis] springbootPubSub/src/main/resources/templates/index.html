<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redis Pub/Sub í…ŒìŠ¤íŠ¸</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .container {
            padding-top: 50px;
        }
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
        }
        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px 15px 0 0 !important;
            padding: 20px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 10px;
            padding: 12px 30px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            border: none;
            border-radius: 10px;
            padding: 12px 30px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }
        .form-control {
            border-radius: 10px;
            border: 2px solid #e9ecef;
            padding: 12px 15px;
            transition: all 0.3s ease;
        }
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        .alert {
            border-radius: 10px;
            border: none;
            padding: 15px 20px;
            margin-bottom: 20px;
        }
        .alert-success {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            color: white;
        }
        .alert-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
        }
        .form-section {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .section-title {
            color: #667eea;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .info-box {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
        }
        .log-section {
            background: #2d3436;
            color: #00b894;
            border-radius: 15px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="card">
                    <div class="card-header text-center">
                        <h1 class="mb-0">
                            <i class="fas fa-broadcast-tower me-3"></i>
                            Redis Pub/Sub í…ŒìŠ¤íŠ¸ ë„êµ¬
                        </h1>
                        <p class="mb-0 mt-2">ì‹¤ì‹œê°„ ë©”ì‹œì§€ ë°œí–‰ ë° êµ¬ë… í…ŒìŠ¤íŠ¸</p>
                        <div class="mt-3">
                            <a href="/users/" class="btn btn-outline-light btn-sm me-2">
                                <i class="fas fa-users me-1"></i>ì‚¬ìš©ì ê´€ë¦¬
                            </a>
                            <small class="text-light">ë‹¤ìˆ˜ ì‚¬ìš©ì í™˜ê²½ì—ì„œ ì±„ë„ë³„ êµ¬ë…ì ê´€ë¦¬</small>
                        </div>
                    </div>
                    <div class="card-body">
                        
                        <!-- ì•Œë¦¼ ë©”ì‹œì§€ -->
                        <div th:if="${successMessage}" class="alert alert-success" role="alert">
                            <i class="fas fa-check-circle me-2"></i>
                            <span th:text="${successMessage}"></span>
                        </div>
                        
                        <div th:if="${errorMessage}" class="alert alert-danger" role="alert">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <span th:text="${errorMessage}"></span>
                        </div>

                        <!-- ì •ë³´ ë°•ìŠ¤ -->
                        <div class="info-box">
                            <h5><i class="fas fa-info-circle me-2"></i>ì‚¬ìš© ë°©ë²•</h5>
                            <ul class="mb-0">
                                <li>ì±„ë„ëª…ì„ ì…ë ¥í•˜ê³  ë©”ì‹œì§€ë¥¼ ì‘ì„±í•œ í›„ "ë©”ì‹œì§€ ë°œì†¡" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”</li>
                                <li>ë©”ì‹œì§€ ë°œì†¡ ì‹œ ìë™ìœ¼ë¡œ í•´ë‹¹ ì±„ë„ì„ êµ¬ë…í•©ë‹ˆë‹¤</li>
                                <li>êµ¬ë…ì„ ì·¨ì†Œí•˜ë ¤ë©´ ì±„ë„ëª…ì„ ì…ë ¥í•˜ê³  "êµ¬ë… ì·¨ì†Œ" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”</li>
                                <li>ì½˜ì†” ë¡œê·¸ì—ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ ë©”ì‹œì§€ ìˆ˜ì‹  ìƒíƒœë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                            </ul>
                        </div>

                        <!-- ë©”ì‹œì§€ ë°œì†¡ ì„¹ì…˜ -->
                        <div class="form-section">
                            <h4 class="section-title">
                                <i class="fas fa-paper-plane"></i>
                                ë©”ì‹œì§€ ë°œì†¡
                            </h4>
                            <form th:action="@{/send-message}" method="post" th:object="${messageDto}">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="channel" class="form-label">
                                            <i class="fas fa-hashtag me-1"></i>ì±„ë„ëª…
                                        </label>
                                        <input type="text" class="form-control" id="channel" name="channel" 
                                               placeholder="ì˜ˆ: chat-room-1" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="sender" class="form-label">
                                            <i class="fas fa-user me-1"></i>ë°œì‹ ì
                                        </label>
                                        <input type="text" class="form-control" id="sender" th:field="*{sender}" 
                                               placeholder="ë°œì‹ ì ì´ë¦„" required>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="roomId" class="form-label">
                                            <i class="fas fa-door-open me-1"></i>ë°© ID
                                        </label>
                                        <input type="text" class="form-control" id="roomId" th:field="*{roomId}" 
                                               placeholder="ë°© ë²ˆí˜¸" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="message" class="form-label">
                                            <i class="fas fa-comment me-1"></i>ë©”ì‹œì§€
                                        </label>
                                        <input type="text" class="form-control" id="message" th:field="*{message}" 
                                               placeholder="ì „ì†¡í•  ë©”ì‹œì§€" required>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <button type="submit" class="btn btn-primary btn-lg">
                                        <i class="fas fa-paper-plane me-2"></i>ë©”ì‹œì§€ ë°œì†¡
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- êµ¬ë… ì·¨ì†Œ ì„¹ì…˜ -->
                        <div class="form-section">
                            <h4 class="section-title">
                                <i class="fas fa-times-circle"></i>
                                êµ¬ë… ì·¨ì†Œ
                            </h4>
                            <form th:action="@{/cancel-subscription}" method="post">
                                <div class="row align-items-end">
                                    <div class="col-md-8 mb-3">
                                        <label for="cancelChannel" class="form-label">
                                            <i class="fas fa-hashtag me-1"></i>ì·¨ì†Œí•  ì±„ë„ëª…
                                        </label>
                                        <input type="text" class="form-control" id="cancelChannel" name="channel" 
                                               placeholder="êµ¬ë…ì„ ì·¨ì†Œí•  ì±„ë„ëª…" required>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <button type="submit" class="btn btn-danger w-100">
                                            <i class="fas fa-times me-2"></i>êµ¬ë… ì·¨ì†Œ
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>

                        <!-- í˜„ì¬ êµ¬ë… ìƒíƒœ ì„¹ì…˜ -->
                        <div class="form-section">
                            <h4 class="section-title">
                                <i class="fas fa-satellite-dish"></i>
                                í˜„ì¬ êµ¬ë… ìƒíƒœ
                                <button type="button" class="btn btn-sm btn-outline-primary ms-auto" onclick="refreshSubscriptionStatus()">
                                    <i class="fas fa-sync-alt me-1"></i>ìƒˆë¡œê³ ì¹¨
                                </button>
                            </h4>
                            
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="d-flex align-items-center mb-3">
                                        <span class="me-3">
                                            <strong>êµ¬ë… ì¤‘ì¸ ì±„ë„ ìˆ˜:</strong> 
                                            <span id="channelCount" class="badge bg-primary">0</span>ê°œ
                                        </span>
                                        <button type="button" class="btn btn-sm btn-info" onclick="showSubscriptionDetails()">
                                            <i class="fas fa-info-circle me-1"></i>ìƒì„¸ ì •ë³´
                                        </button>
                                    </div>
                                    
                                    <div id="channelList" class="border rounded p-3" style="min-height: 80px; background-color: #f8f9fa;">
                                        <div th:if="${subscribedChannels != null and !subscribedChannels.isEmpty()}">
                                            <div th:each="channel : ${subscribedChannels}" class="d-inline-block">
                                                <span class="badge bg-secondary me-2 mb-2" style="font-size: 0.9em;">
                                                    <i class="fas fa-hashtag me-1"></i>
                                                    <span th:text="${channel}"></span>
                                                </span>
                                            </div>
                                        </div>
                                        <div th:if="${subscribedChannels == null or subscribedChannels.isEmpty()}" 
                                             class="text-muted text-center py-2">
                                            <i class="fas fa-info-circle me-2"></i>
                                            í˜„ì¬ êµ¬ë… ì¤‘ì¸ ì±„ë„ì´ ì—†ìŠµë‹ˆë‹¤.
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <div class="card border-0" style="background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);">
                                        <div class="card-body text-white text-center">
                                            <h6 class="card-title">
                                                <i class="fas fa-chart-line me-2"></i>
                                                ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
                                            </h6>
                                            <p class="card-text small mb-2">
                                                êµ¬ë… ìƒíƒœê°€ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.
                                            </p>
                                            <small class="text-light">
                                                <i class="fas fa-clock me-1"></i>
                                                ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: <span id="lastUpdateTime">-</span>
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ë¡œê·¸ ì„¹ì…˜ -->
                        <div class="form-section">
                            <h4 class="section-title">
                                <i class="fas fa-terminal"></i>
                                ì‹¤ì‹œê°„ ë¡œê·¸ ëª¨ë‹ˆí„°ë§
                            </h4>
                            <div class="log-section">
                                <div id="log-content">
                                    <p><i class="fas fa-info-circle me-2"></i>ì• í”Œë¦¬ì¼€ì´ì…˜ ì½˜ì†”ì—ì„œ ì‹¤ì‹œê°„ ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
                                    <p><i class="fas fa-arrow-right me-2"></i>ë©”ì‹œì§€ ë°œì†¡ ì‹œ: "Redis Pub MSG Channel = {ì±„ë„ëª…}"</p>
                                    <p><i class="fas fa-arrow-right me-2"></i>ë©”ì‹œì§€ ìˆ˜ì‹  ì‹œ: "Redis Subscribe Channel : {ë°©ID}"</p>
                                    <p><i class="fas fa-arrow-right me-2"></i>ë©”ì‹œì§€ ë‚´ìš©: "Redis SUB Message : {ë©”ì‹œì§€ë‚´ìš©}"</p>
                                </div>
                            </div>
                        </div>

                        <!-- API í…ŒìŠ¤íŠ¸ ì„¹ì…˜ -->
                        <div class="form-section">
                            <h4 class="section-title">
                                <i class="fas fa-code"></i>
                                REST API í…ŒìŠ¤íŠ¸
                            </h4>
                            <div class="row">
                                <div class="col-md-6">
                                    <h6><i class="fas fa-paper-plane me-2"></i>ë©”ì‹œì§€ ë°œì†¡ API</h6>
                                    <div class="log-section mb-3">
                                        <code>
POST /redis/pubsub/send?channel={ì±„ë„ëª…}<br>
Content-Type: application/json<br><br>
{<br>
&nbsp;&nbsp;"message": "í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€",<br>
&nbsp;&nbsp;"sender": "ë°œì‹ ì",<br>
&nbsp;&nbsp;"roomId": "ë°©ë²ˆí˜¸"<br>
}
                                        </code>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6><i class="fas fa-times me-2"></i>êµ¬ë… ì·¨ì†Œ API</h6>
                                    <div class="log-section mb-3">
                                        <code>
POST /redis/pubsub/cancel?channel={ì±„ë„ëª…}
                                        </code>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <h6><i class="fas fa-list me-2"></i>êµ¬ë… ì±„ë„ ëª©ë¡ API</h6>
                                    <div class="log-section mb-3">
                                        <code>
GET /redis/pubsub/subscribed-channels<br><br>
ì‘ë‹µ: ["channel1", "channel2", ...]
                                        </code>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6><i class="fas fa-info-circle me-2"></i>êµ¬ë… ìƒíƒœ ìƒì„¸ API</h6>
                                    <div class="log-section mb-3">
                                        <code>
GET /redis/pubsub/subscription-status<br><br>
ì‘ë‹µ: {<br>
&nbsp;&nbsp;"subscribedChannels": [...],<br>
&nbsp;&nbsp;"totalChannelCount": 2,<br>
&nbsp;&nbsp;"isRunning": true,<br>
&nbsp;&nbsp;...<br>
}
                                        </code>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ì½˜ì†” ë¡œê·¸ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        function logToConsole(type, message, data = null) {
            const timestamp = new Date().toLocaleTimeString('ko-KR');
            const logMessage = `[${timestamp}] Redis Pub/Sub - ${message}`;
            
            switch(type) {
                case 'info':
                    console.info('ğŸ“¡ ' + logMessage, data || '');
                    break;
                case 'success':
                    console.log('âœ… ' + logMessage, data || '');
                    break;
                case 'error':
                    console.error('âŒ ' + logMessage, data || '');
                    break;
                case 'warning':
                    console.warn('âš ï¸ ' + logMessage, data || '');
                    break;
                default:
                    console.log('ğŸ”” ' + logMessage, data || '');
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            logToConsole('info', 'í˜ì´ì§€ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
            console.group('ğŸš€ Redis Pub/Sub í…ŒìŠ¤íŠ¸ ë„êµ¬');
            console.log('ğŸ“‹ ì‚¬ìš© ê°€ëŠ¥í•œ ê¸°ëŠ¥:');
            console.log('  â€¢ ë©”ì‹œì§€ ë°œì†¡');
            console.log('  â€¢ êµ¬ë… ì·¨ì†Œ');
            console.log('  â€¢ êµ¬ë… ìƒíƒœ ëª¨ë‹ˆí„°ë§');
            console.log('  â€¢ ì‹¤ì‹œê°„ ë¡œê·¸ ëª¨ë‹ˆí„°ë§');
            console.groupEnd();
            
            // êµ¬ë… ìƒíƒœ ì´ˆê¸°í™” ë° ìë™ ê°±ì‹  ì‹œì‘
            refreshSubscriptionStatus();
            
            // 10ì´ˆë§ˆë‹¤ ìë™ìœ¼ë¡œ êµ¬ë… ìƒíƒœ ì—…ë°ì´íŠ¸
            setInterval(refreshSubscriptionStatus, 10000);
        });

        // êµ¬ë… ìƒíƒœë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ëŠ” í•¨ìˆ˜
        async function refreshSubscriptionStatus() {
            try {
                const response = await fetch('/subscribed-channels');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const channels = await response.json();
                
                // ì±„ë„ ìˆ˜ ì—…ë°ì´íŠ¸
                document.getElementById('channelCount').textContent = channels.length;
                
                // ì±„ë„ ëª©ë¡ ì—…ë°ì´íŠ¸
                const channelListDiv = document.getElementById('channelList');
                
                if (channels.length === 0) {
                    channelListDiv.innerHTML = `
                        <div class="text-muted text-center py-2">
                            <i class="fas fa-info-circle me-2"></i>
                            í˜„ì¬ êµ¬ë… ì¤‘ì¸ ì±„ë„ì´ ì—†ìŠµë‹ˆë‹¤.
                        </div>
                    `;
                } else {
                    channelListDiv.innerHTML = channels.map(channel => `
                        <span class="badge bg-secondary me-2 mb-2" style="font-size: 0.9em;">
                            <i class="fas fa-hashtag me-1"></i>
                            ${channel}
                        </span>
                    `).join('');
                }
                
                // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ ê¸°ë¡
                const now = new Date().toLocaleTimeString('ko-KR');
                document.getElementById('lastUpdateTime').textContent = now;
                
                logToConsole('info', `êµ¬ë… ìƒíƒœ ì—…ë°ì´íŠ¸ ì™„ë£Œ - ${channels.length}ê°œ ì±„ë„`, channels);
                
            } catch (error) {
                console.error('êµ¬ë… ìƒíƒœ ì¡°íšŒ ì‹¤íŒ¨:', error);
                document.getElementById('channelCount').textContent = '?';
                document.getElementById('channelList').innerHTML = `
                    <div class="text-danger text-center py-2">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        êµ¬ë… ìƒíƒœë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
                    </div>
                `;
                document.getElementById('lastUpdateTime').textContent = 'ì˜¤ë¥˜';
                
                logToConsole('error', 'êµ¬ë… ìƒíƒœ ì¡°íšŒ ì‹¤íŒ¨', error.message);
            }
        }

        // êµ¬ë… ìƒì„¸ ì •ë³´ë¥¼ ë³´ì—¬ì£¼ëŠ” í•¨ìˆ˜
        async function showSubscriptionDetails() {
            try {
                const response = await fetch('/subscription-status');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const status = await response.json();
                
                let modalContent = '';
                
                if (status.error) {
                    modalContent = `
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-circle me-2"></i>
                            ì˜¤ë¥˜ ë°œìƒ: ${status.error}
                        </div>
                    `;
                } else {
                    let channelDetailsHtml = '';
                    if (status.channelSubscriptionDetails && Object.keys(status.channelSubscriptionDetails).length > 0) {
                        channelDetailsHtml = `
                            <h6 class="mt-3">ì±„ë„ë³„ êµ¬ë… ìœ ì§€ ì‹œê°„:</h6>
                            <div class="row">
                                ${Object.entries(status.channelSubscriptionDetails).map(([channel, duration]) => `
                                    <div class="col-md-6 mb-2">
                                        <span class="badge bg-primary me-2">${channel}</span>
                                        <small class="text-muted">${duration}</small>
                                    </div>
                                `).join('')}
                            </div>
                        `;
                    }
                    
                    modalContent = `
                        <div class="row">
                            <div class="col-md-6">
                                <h6>ì‹œìŠ¤í…œ ìƒíƒœ</h6>
                                <ul class="list-unstyled">
                                    <li><strong>ì´ êµ¬ë… ì±„ë„ ìˆ˜:</strong> ${status.totalChannelCount}ê°œ</li>
                                    <li><strong>ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ìƒíƒœ:</strong> 
                                        ${status.isRunning ? 
                                            '<span class="badge bg-success">ì‹¤í–‰ ì¤‘</span>' : 
                                            '<span class="badge bg-danger">ì¤‘ì§€ë¨</span>'}
                                    </li>
                                    <li><strong>ì»¨í…Œì´ë„ˆ í™œì„± ìƒíƒœ:</strong> 
                                        ${status.isActive ? 
                                            '<span class="badge bg-success">í™œì„±</span>' : 
                                            '<span class="badge bg-warning">ë¹„í™œì„±</span>'}
                                    </li>
                                    <li><strong>ì¡°íšŒ ì‹œê°„:</strong> <small>${status.checkTime}</small></li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>êµ¬ë… ì¤‘ì¸ ì±„ë„</h6>
                                ${status.subscribedChannels && status.subscribedChannels.length > 0 ? 
                                    '<div>' + status.subscribedChannels.map(channel => `
                                        <span class="badge bg-secondary me-1 mb-1">${channel}</span>
                                    `).join('') + '</div>' : 
                                    '<span class="text-muted">êµ¬ë… ì¤‘ì¸ ì±„ë„ì´ ì—†ìŠµë‹ˆë‹¤.</span>'}
                            </div>
                        </div>
                        ${channelDetailsHtml}
                    `;
                }
                
                // Bootstrap ëª¨ë‹¬ì„ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ê³  í‘œì‹œ
                const modalHtml = `
                    <div class="modal fade" id="subscriptionModal" tabindex="-1">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">
                                        <i class="fas fa-chart-line me-2"></i>
                                        êµ¬ë… ìƒíƒœ ìƒì„¸ ì •ë³´
                                    </h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body">
                                    ${modalContent}
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
                                    <button type="button" class="btn btn-primary" onclick="refreshSubscriptionStatus(); showSubscriptionDetails();">
                                        <i class="fas fa-sync-alt me-2"></i>ìƒˆë¡œê³ ì¹¨
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // ê¸°ì¡´ ëª¨ë‹¬ ì œê±° (ìˆë‹¤ë©´)
                const existingModal = document.getElementById('subscriptionModal');
                if (existingModal) {
                    existingModal.remove();
                }
                
                // ìƒˆ ëª¨ë‹¬ ì¶”ê°€
                document.body.insertAdjacentHTML('beforeend', modalHtml);
                
                // ëª¨ë‹¬ í‘œì‹œ
                const modal = new bootstrap.Modal(document.getElementById('subscriptionModal'));
                modal.show();
                
                logToConsole('info', 'êµ¬ë… ìƒì„¸ ì •ë³´ ì¡°íšŒ ì™„ë£Œ');
                
            } catch (error) {
                console.error('êµ¬ë… ìƒì„¸ ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:', error);
                alert('êµ¬ë… ìƒì„¸ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + error.message);
                logToConsole('error', 'êµ¬ë… ìƒì„¸ ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨', error.message);
            }
        }

        // í¼ ì œì¶œ ì‹œ ë¡œë”© íš¨ê³¼ ë° ë¡œê·¸
        document.querySelectorAll('form').forEach(form => {
            form.addEventListener('submit', function(e) {
                const submitBtn = this.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerHTML;
                const formAction = this.action;
                
                // í¼ ë°ì´í„° ìˆ˜ì§‘
                const formData = new FormData(this);
                const formDataObj = {};
                for (let [key, value] of formData.entries()) {
                    formDataObj[key] = value;
                }
                
                // ë©”ì‹œì§€ ë°œì†¡ í¼ì¸ì§€ êµ¬ë… ì·¨ì†Œ í¼ì¸ì§€ í™•ì¸
                if (formAction.includes('send-message')) {
                    logToConsole('info', 'ë©”ì‹œì§€ ë°œì†¡ ìš”ì²­', {
                        channel: formDataObj.channel,
                        sender: formDataObj.sender,
                        roomId: formDataObj.roomId,
                        message: formDataObj.message
                    });
                    console.group('ğŸ“¤ ë©”ì‹œì§€ ë°œì†¡');
                    console.log('ì±„ë„:', formDataObj.channel);
                    console.log('ë°œì‹ ì:', formDataObj.sender);
                    console.log('ë°© ID:', formDataObj.roomId);
                    console.log('ë©”ì‹œì§€:', formDataObj.message);
                    console.groupEnd();
                } else if (formAction.includes('cancel-subscription')) {
                    logToConsole('warning', 'êµ¬ë… ì·¨ì†Œ ìš”ì²­', {
                        channel: formDataObj.channel
                    });
                    console.group('ğŸš« êµ¬ë… ì·¨ì†Œ');
                    console.log('ì±„ë„:', formDataObj.channel);
                    console.groupEnd();
                }
                
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>ì²˜ë¦¬ì¤‘...';
                submitBtn.disabled = true;
                
                // 3ì´ˆ í›„ ì›ë˜ ìƒíƒœë¡œ ë³µì› (ì‹¤ì œë¡œëŠ” í˜ì´ì§€ê°€ ë¦¬ë¡œë“œë¨)
                setTimeout(() => {
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }, 3000);
            });
        });

        // ì„±ê³µ/ì—ëŸ¬ ë©”ì‹œì§€ ìë™ ìˆ¨ê¹€ ë° ì½˜ì†” ë¡œê·¸
        setTimeout(() => {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                const isSuccess = alert.classList.contains('alert-success');
                const isError = alert.classList.contains('alert-danger');
                const message = alert.textContent.trim();
                
                if (isSuccess) {
                    logToConsole('success', 'ì‘ì—… ì™„ë£Œ', message);
                } else if (isError) {
                    logToConsole('error', 'ì˜¤ë¥˜ ë°œìƒ', message);
                }
                
                alert.style.transition = 'opacity 0.5s ease';
                alert.style.opacity = '0';
                setTimeout(() => {
                    alert.remove();
                }, 500);
            });
        }, 5000);

        // ì‹¤ì‹œê°„ ë¡œê·¸ ì‹œë®¬ë ˆì´ì…˜ (ì‹¤ì œ Redis ì—°ê²°ì´ ìˆë‹¤ë©´ WebSocketìœ¼ë¡œ ëŒ€ì²´)
        function simulateRedisLogs() {
            logToConsole('info', 'ì‹¤ì‹œê°„ ë¡œê·¸ ëª¨ë‹ˆí„°ë§ì„ ì‹œì‘í•©ë‹ˆë‹¤.');
            console.log('ğŸ’¡ ì‹¤ì œ Redis ë©”ì‹œì§€ëŠ” ì„œë²„ ì½˜ì†”ì—ì„œ í™•ì¸í•˜ì„¸ìš”.');
            console.log('ğŸ”— WebSocket ì—°ê²°ì´ êµ¬í˜„ë˜ë©´ ì—¬ê¸°ì„œ ì‹¤ì‹œê°„ ë©”ì‹œì§€ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        }

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
        document.addEventListener('keydown', function(e) {
            // Ctrl + Shift + L: ì½˜ì†” í´ë¦¬ì–´
            if (e.ctrlKey && e.shiftKey && e.key === 'L') {
                console.clear();
                logToConsole('info', 'ì½˜ì†”ì´ í´ë¦¬ì–´ë˜ì—ˆìŠµë‹ˆë‹¤.');
                e.preventDefault();
            }
            
            // Ctrl + Shift + R: Redis ë¡œê·¸ ì‹œë®¬ë ˆì´ì…˜
            if (e.ctrlKey && e.shiftKey && e.key === 'R') {
                simulateRedisLogs();
                e.preventDefault();
            }
        });

        // ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ ì•ˆë‚´
        console.log('%cğŸ”§ ê°œë°œì ë„êµ¬ ì•ˆë‚´', 'color: #667eea; font-size: 16px; font-weight: bold;');
        console.log('%cë‹¨ì¶•í‚¤:', 'color: #764ba2; font-weight: bold;');
        console.log('  Ctrl + Shift + L: ì½˜ì†” í´ë¦¬ì–´');
        console.log('  Ctrl + Shift + R: Redis ë¡œê·¸ ì‹œë®¬ë ˆì´ì…˜');
        console.log('%cF12 ë˜ëŠ” Ctrl+Shift+Ië¡œ ê°œë°œì ë„êµ¬ë¥¼ ì—´ì–´ ì‹¤ì‹œê°„ ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”!', 'color: #00b894; font-weight: bold;');

        // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ
        window.addEventListener('beforeunload', function() {
            logToConsole('info', 'í˜ì´ì§€ë¥¼ ë– ë‚©ë‹ˆë‹¤.');
        });

        // ì—ëŸ¬ ìºì¹­
        window.addEventListener('error', function(e) {
            logToConsole('error', 'JavaScript ì˜¤ë¥˜ ë°œìƒ', {
                message: e.message,
                filename: e.filename,
                lineno: e.lineno
            });
        });
    </script>
</body>
</html> 