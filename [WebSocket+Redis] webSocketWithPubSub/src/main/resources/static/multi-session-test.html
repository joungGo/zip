<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi WebSocket Session Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .control-group {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .sessions-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .session-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 15px;
            border: 2px solid #ddd;
        }
        
        .session-card.connected {
            border-color: #28a745;
        }
        
        .session-card.disconnected {
            border-color: #dc3545;
        }
        
        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .session-title {
            font-weight: bold;
            font-size: 16px;
        }
        
        .session-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-connected {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-disconnected {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .session-controls {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }
        
        .session-controls button {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .btn-connect {
            background-color: #28a745;
            color: white;
        }
        
        .btn-disconnect {
            background-color: #dc3545;
            color: white;
        }
        
        .btn-connect:disabled, .btn-disconnect:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        
        .message-area {
            height: 200px;
            border: 1px solid #ddd;
            padding: 8px;
            overflow-y: auto;
            background-color: #f9f9f9;
            margin-bottom: 10px;
            font-size: 12px;
        }
        
        .message-input-group {
            display: flex;
            gap: 5px;
        }
        
        .message-input {
            flex: 1;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .btn-send {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .btn-send:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        
        .global-controls {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .global-controls h3 {
            margin-top: 0;
            margin-bottom: 15px;
        }
        
        .global-button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .global-button-group button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        
        .btn-success {
            background-color: #28a745;
            color: white;
        }
        
        .btn-warning {
            background-color: #ffc107;
            color: #212529;
        }
        
        .btn-danger {
            background-color: #dc3545;
            color: white;
        }
        
        .broadcast-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .broadcast-input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .stats {
            background-color: #e9ecef;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Multi WebSocket Session Test</h1>
        <p>ì—¬ëŸ¬ WebSocket ì„¸ì…˜ì„ ë™ì‹œì— ê´€ë¦¬í•˜ê³  ë¸Œë¡œë“œìºìŠ¤íŠ¸ ë©”ì‹œì§€ë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    </div>

    <div class="global-controls">
        <h3>ì „ì²´ ì œì–´</h3>
        
        <div class="stats" id="globalStats">
            í™œì„± ì„¸ì…˜: 0ê°œ | ì´ ìƒì„±ëœ ì„¸ì…˜: 0ê°œ
        </div>
        
        <div class="global-button-group">
            <button class="btn-primary" onclick="createNewSession()">ìƒˆ ì„¸ì…˜ ì¶”ê°€</button>
            <button class="btn-success" onclick="connectAllSessions()">ëª¨ë“  ì„¸ì…˜ ì—°ê²°</button>
            <button class="btn-warning" onclick="disconnectAllSessions()">ëª¨ë“  ì„¸ì…˜ í•´ì œ</button>
            <button class="btn-danger" onclick="removeAllSessions()">ëª¨ë“  ì„¸ì…˜ ì œê±°</button>
        </div>
        
        <div class="global-button-group">
            <button class="btn-primary" onclick="getSessionCount()">ì„œë²„ ì„¸ì…˜ ìˆ˜ ì¡°íšŒ</button>
            <button class="btn-primary" onclick="getServerStatus()">ì„œë²„ ìƒíƒœ ì¡°íšŒ</button>
        </div>
        
        <div class="broadcast-group">
            <input type="text" class="broadcast-input" id="broadcastMessage" 
                   placeholder="ëª¨ë“  ì„¸ì…˜ì— ë¸Œë¡œë“œìºìŠ¤íŠ¸í•  ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
            <button class="btn-success" onclick="sendBroadcast()">ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì „ì†¡</button>
        </div>
    </div>

    <div class="sessions-container" id="sessionsContainer">
        <!-- ì„¸ì…˜ ì¹´ë“œë“¤ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
    </div>

    <script>
        // ========== ì „ì—­ ë³€ìˆ˜ ==========
        
        /**
         * ëª¨ë“  WebSocket ì„¸ì…˜ì„ ê´€ë¦¬í•˜ëŠ” ë°°ì—´
         * ê° ìš”ì†ŒëŠ” ì„¸ì…˜ ì •ë³´ ê°ì²´ { id, websocket, element, connected }
         */
        let sessions = [];
        
        /**
         * ì„¸ì…˜ ID ìƒì„±ì„ ìœ„í•œ ì¹´ìš´í„°
         */
        let sessionCounter = 0;

        // ========== ì„¸ì…˜ ê´€ë¦¬ í•¨ìˆ˜ ==========
        
        /**
         * ìƒˆë¡œìš´ WebSocket ì„¸ì…˜ì„ ìƒì„±í•˜ëŠ” í•¨ìˆ˜
         */
        function createNewSession() {
            sessionCounter++;
            const sessionId = `session-${sessionCounter}`;
            
            console.log(`ğŸ†• ìƒˆ ì„¸ì…˜ ìƒì„±: ${sessionId}`);
            
            // ì„¸ì…˜ ê°ì²´ ìƒì„±
            const session = {
                id: sessionId,
                websocket: null,
                element: null,
                connected: false
            };
            
            // ì„¸ì…˜ UI ìš”ì†Œ ìƒì„±
            session.element = createSessionElement(session);
            
            // ì„¸ì…˜ ë°°ì—´ì— ì¶”ê°€
            sessions.push(session);
            
            // DOMì— ì„¸ì…˜ ì¹´ë“œ ì¶”ê°€
            document.getElementById('sessionsContainer').appendChild(session.element);
            
            // í†µê³„ ì—…ë°ì´íŠ¸
            updateGlobalStats();
            
            console.log(`ìƒˆ ì„¸ì…˜ ìƒì„±: ${sessionId}`);
        }
        
        /**
         * ì„¸ì…˜ UI ìš”ì†Œë¥¼ ìƒì„±í•˜ëŠ” í•¨ìˆ˜
         * @param {Object} session - ì„¸ì…˜ ê°ì²´
         * @returns {HTMLElement} ìƒì„±ëœ ì„¸ì…˜ ì¹´ë“œ ìš”ì†Œ
         */
        function createSessionElement(session) {
            const sessionCard = document.createElement('div');
            sessionCard.className = 'session-card disconnected';
            sessionCard.id = session.id;
            
            sessionCard.innerHTML = `
                <div class="session-header">
                    <div class="session-title">${session.id}</div>
                    <div class="session-status status-disconnected">ì—°ê²° ì•ˆë¨</div>
                </div>
                
                <div class="session-controls">
                    <button class="btn-connect" onclick="connectSession('${session.id}')">ì—°ê²°</button>
                    <button class="btn-disconnect" onclick="disconnectSession('${session.id}')" disabled>í•´ì œ</button>
                    <button class="btn-danger" onclick="removeSession('${session.id}')">ì œê±°</button>
                </div>
                
                <div class="message-area" id="messages-${session.id}"></div>
                
                <div class="message-input-group">
                    <input type="text" class="message-input" id="input-${session.id}" 
                           placeholder="ë©”ì‹œì§€ ì…ë ¥..." disabled>
                    <button class="btn-send" onclick="sendMessage('${session.id}')" disabled>ì „ì†¡</button>
                </div>
            `;
            
            // Enter í‚¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            const messageInput = sessionCard.querySelector(`#input-${session.id}`);
            messageInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage(session.id);
                }
            });
            
            return sessionCard;
        }
        
        /**
         * íŠ¹ì • ì„¸ì…˜ì„ WebSocket ì„œë²„ì— ì—°ê²°í•˜ëŠ” í•¨ìˆ˜
         * @param {string} sessionId - ì—°ê²°í•  ì„¸ì…˜ ID
         */
        function connectSession(sessionId) {
            const session = sessions.find(s => s.id === sessionId);
            if (!session || session.connected) return;
            
            const wsUrl = `ws://${window.location.host}/my-websocket`;
            
            console.log(`ğŸ”— ì„¸ì…˜ ì—°ê²° ì‹œë„: ${sessionId} -> ${wsUrl}`);
            
            session.websocket = new WebSocket(wsUrl);
            
            // WebSocket ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì„¤ì •
            session.websocket.onopen = function(event) {
                console.log(`âœ… ì„¸ì…˜ ì—°ê²° ì„±ê³µ: ${sessionId}`, event);
                
                session.connected = true;
                updateSessionUI(session, true);
                addMessageToSession(session.id, `ì‹œìŠ¤í…œ: WebSocket ì—°ê²° ì„±ê³µ`, 'system');
                updateGlobalStats();
            };
            
            session.websocket.onmessage = function(event) {
                console.log(`ğŸ“¨ ì„¸ì…˜ ë©”ì‹œì§€ ìˆ˜ì‹ : ${sessionId} ->`, event.data);
                
                addMessageToSession(session.id, `ì„œë²„: ${event.data}`, 'received');
            };
            
            session.websocket.onclose = function(event) {
                console.log(`ğŸ”Œ ì„¸ì…˜ ì—°ê²° ì¢…ë£Œ: ${sessionId}`, event.code, event.reason);
                
                session.connected = false;
                updateSessionUI(session, false);
                addMessageToSession(session.id, `ì‹œìŠ¤í…œ: WebSocket ì—°ê²° ì¢…ë£Œ`, 'system');
                updateGlobalStats();
            };
            
            session.websocket.onerror = function(error) {
                console.error(`âŒ ì„¸ì…˜ ì—°ê²° ì—ëŸ¬: ${sessionId}`, error);
                
                addMessageToSession(session.id, `ì‹œìŠ¤í…œ: ì—°ê²° ì˜¤ë¥˜ ë°œìƒ`, 'error');
            };
        }
        
        /**
         * íŠ¹ì • ì„¸ì…˜ì˜ WebSocket ì—°ê²°ì„ í•´ì œí•˜ëŠ” í•¨ìˆ˜
         * @param {string} sessionId - í•´ì œí•  ì„¸ì…˜ ID
         */
        function disconnectSession(sessionId) {
            const session = sessions.find(s => s.id === sessionId);
            if (!session || !session.connected) return;
            
            console.log(`ğŸ”Œ ì„¸ì…˜ ì—°ê²° í•´ì œ ìš”ì²­: ${sessionId}`);
            
            if (session.websocket) {
                session.websocket.close();
            }
        }
        
        /**
         * íŠ¹ì • ì„¸ì…˜ì„ ì™„ì „íˆ ì œê±°í•˜ëŠ” í•¨ìˆ˜
         * @param {string} sessionId - ì œê±°í•  ì„¸ì…˜ ID
         */
        function removeSession(sessionId) {
            const sessionIndex = sessions.findIndex(s => s.id === sessionId);
            if (sessionIndex === -1) return;
            
            console.log(`ğŸ—‘ï¸ ì„¸ì…˜ ì œê±° ì‹œì‘: ${sessionId}`);
            
            const session = sessions[sessionIndex];
            
            // WebSocket ì—°ê²°ì´ ìˆë‹¤ë©´ í•´ì œ
            if (session.websocket) {
                session.websocket.close();
            }
            
            // DOMì—ì„œ ì„¸ì…˜ ì¹´ë“œ ì œê±°
            session.element.remove();
            
            // ì„¸ì…˜ ë°°ì—´ì—ì„œ ì œê±°
            sessions.splice(sessionIndex, 1);
            
            // í†µê³„ ì—…ë°ì´íŠ¸
            updateGlobalStats();
            
            console.log(`ì„¸ì…˜ ì œê±°: ${sessionId}`);
        }
        
        /**
         * íŠ¹ì • ì„¸ì…˜ì— ë©”ì‹œì§€ë¥¼ ì „ì†¡í•˜ëŠ” í•¨ìˆ˜
         * @param {string} sessionId - ë©”ì‹œì§€ë¥¼ ì „ì†¡í•  ì„¸ì…˜ ID
         */
        function sendMessage(sessionId) {
            const session = sessions.find(s => s.id === sessionId);
            if (!session || !session.connected) return;
            
            const messageInput = document.getElementById(`input-${sessionId}`);
            const message = messageInput.value.trim();
            
            if (message && session.websocket && session.websocket.readyState === WebSocket.OPEN) {
                console.log(`ğŸ“¤ ì„¸ì…˜ ë©”ì‹œì§€ ì „ì†¡: ${sessionId} ->`, message);
                
                session.websocket.send(message);
                addMessageToSession(sessionId, `ë‚˜: ${message}`, 'sent');
                messageInput.value = '';
            } else {
                console.warn(`âš ï¸ ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨: ${sessionId} - ì—°ê²°ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ë©”ì‹œì§€ê°€ ë¹„ì–´ìˆìŒ`);
            }
        }

        // ========== ì „ì²´ ì œì–´ í•¨ìˆ˜ ==========
        
        /**
         * ëª¨ë“  ì„¸ì…˜ì„ WebSocket ì„œë²„ì— ì—°ê²°í•˜ëŠ” í•¨ìˆ˜
         */
        function connectAllSessions() {
            console.log(`ğŸ”— ëª¨ë“  ì„¸ì…˜ ì—°ê²° ì‹œì‘ (ì´ ${sessions.length}ê°œ ì„¸ì…˜)`);
            
            sessions.forEach(session => {
                if (!session.connected) {
                    connectSession(session.id);
                }
            });
        }
        
        /**
         * ëª¨ë“  ì„¸ì…˜ì˜ WebSocket ì—°ê²°ì„ í•´ì œí•˜ëŠ” í•¨ìˆ˜
         */
        function disconnectAllSessions() {
            console.log(`ğŸ”Œ ëª¨ë“  ì„¸ì…˜ ì—°ê²° í•´ì œ ì‹œì‘ (ì´ ${sessions.length}ê°œ ì„¸ì…˜)`);
            
            sessions.forEach(session => {
                if (session.connected) {
                    disconnectSession(session.id);
                }
            });
        }
        
        /**
         * ëª¨ë“  ì„¸ì…˜ì„ ì œê±°í•˜ëŠ” í•¨ìˆ˜
         */
        function removeAllSessions() {
            console.log(`ğŸ—‘ï¸ ëª¨ë“  ì„¸ì…˜ ì œê±° ì‹œì‘ (ì´ ${sessions.length}ê°œ ì„¸ì…˜)`);
            
            // ì—­ìˆœìœ¼ë¡œ ì œê±° (ë°°ì—´ ì¸ë±ìŠ¤ ë¬¸ì œ ë°©ì§€)
            for (let i = sessions.length - 1; i >= 0; i--) {
                removeSession(sessions[i].id);
            }
        }

        // ========== UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ==========
        
        /**
         * ì„¸ì…˜ UI ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
         * @param {Object} session - ì—…ë°ì´íŠ¸í•  ì„¸ì…˜ ê°ì²´
         * @param {boolean} connected - ì—°ê²° ìƒíƒœ
         */
        function updateSessionUI(session, connected) {
            const sessionCard = session.element;
            const statusElement = sessionCard.querySelector('.session-status');
            const connectBtn = sessionCard.querySelector('.btn-connect');
            const disconnectBtn = sessionCard.querySelector('.btn-disconnect');
            const messageInput = sessionCard.querySelector('.message-input');
            const sendBtn = sessionCard.querySelector('.btn-send');
            
            if (connected) {
                sessionCard.className = 'session-card connected';
                statusElement.className = 'session-status status-connected';
                statusElement.textContent = 'ì—°ê²°ë¨';
                connectBtn.disabled = true;
                disconnectBtn.disabled = false;
                messageInput.disabled = false;
                sendBtn.disabled = false;
            } else {
                sessionCard.className = 'session-card disconnected';
                statusElement.className = 'session-status status-disconnected';
                statusElement.textContent = 'ì—°ê²° ì•ˆë¨';
                connectBtn.disabled = false;
                disconnectBtn.disabled = true;
                messageInput.disabled = true;
                sendBtn.disabled = true;
            }
        }
        
        /**
         * íŠ¹ì • ì„¸ì…˜ì˜ ë©”ì‹œì§€ ì˜ì—­ì— ë©”ì‹œì§€ë¥¼ ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜
         * @param {string} sessionId - ì„¸ì…˜ ID
         * @param {string} message - ë©”ì‹œì§€ ë‚´ìš©
         * @param {string} type - ë©”ì‹œì§€ íƒ€ì…
         */
        function addMessageToSession(sessionId, message, type) {
            const messagesDiv = document.getElementById(`messages-${sessionId}`);
            const messageElement = document.createElement('div');
            
            messageElement.textContent = new Date().toLocaleTimeString() + ' - ' + message;
            messageElement.style.marginBottom = '3px';
            
            switch(type) {
                case 'sent':
                    messageElement.style.color = '#007bff';
                    break;
                case 'received':
                    messageElement.style.color = '#28a745';
                    break;
                case 'system':
                    messageElement.style.color = '#6c757d';
                    messageElement.style.fontStyle = 'italic';
                    break;
                case 'error':
                    messageElement.style.color = '#dc3545';
                    break;
            }
            
            messagesDiv.appendChild(messageElement);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        /**
         * ì „ì²´ í†µê³„ë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
         */
        function updateGlobalStats() {
            const totalSessions = sessions.length;
            const activeSessions = sessions.filter(s => s.connected).length;
            
            console.log(`ğŸ“Š ì„¸ì…˜ í†µê³„ ì—…ë°ì´íŠ¸: í™œì„± ${activeSessions}ê°œ / ì´ ${totalSessions}ê°œ`);
            
            document.getElementById('globalStats').textContent = 
                `í™œì„± ì„¸ì…˜: ${activeSessions}ê°œ | ì´ ìƒì„±ëœ ì„¸ì…˜: ${totalSessions}ê°œ`;
        }

        // ========== REST API í•¨ìˆ˜ ==========
        
        /**
         * ì„œë²„ì˜ í™œì„± ì„¸ì…˜ ìˆ˜ë¥¼ ì¡°íšŒí•˜ëŠ” í•¨ìˆ˜
         */
        async function getSessionCount() {
            try {
                console.log('ğŸ” API í˜¸ì¶œ: ì„œë²„ í™œì„± ì„¸ì…˜ ìˆ˜ ì¡°íšŒ');
                
                const response = await fetch('/api/websocket/sessions/count');
                const data = await response.json();
                
                console.log('ğŸ“Š ì„œë²„ í™œì„± ì„¸ì…˜ ìˆ˜ ì¡°íšŒ ê²°ê³¼:', data);
                
                // ëª¨ë“  ì„¸ì…˜ì— ê²°ê³¼ í‘œì‹œ
                sessions.forEach(session => {
                    addMessageToSession(session.id, `API: ì„œë²„ í™œì„± ì„¸ì…˜ ìˆ˜ - ${data.activeSessionCount}`, 'system');
                });
                
                console.log('ì„œë²„ í™œì„± ì„¸ì…˜ ìˆ˜:', data.activeSessionCount);
            } catch (error) {
                console.error('âŒ API í˜¸ì¶œ ì‹¤íŒ¨ (ì„œë²„ ì„¸ì…˜ ìˆ˜ ì¡°íšŒ):', error);
                
                sessions.forEach(session => {
                    addMessageToSession(session.id, `API ì˜¤ë¥˜: ${error.message}`, 'error');
                });
            }
        }
        
        /**
         * ì„œë²„ ìƒíƒœë¥¼ ì¡°íšŒí•˜ëŠ” í•¨ìˆ˜
         */
        async function getServerStatus() {
            try {
                console.log('ğŸ” API í˜¸ì¶œ: ì„œë²„ ìƒíƒœ ì¡°íšŒ');
                
                const response = await fetch('/api/websocket/status');
                const data = await response.json();
                
                console.log('ğŸ“Š ì„œë²„ ìƒíƒœ ì¡°íšŒ ê²°ê³¼:', data);
                
                // ëª¨ë“  ì„¸ì…˜ì— ê²°ê³¼ í‘œì‹œ
                sessions.forEach(session => {
                    addMessageToSession(session.id, 
                        `API: ì„œë²„ ìƒíƒœ - ${data.status}, ì—°ê²° ìˆ˜: ${data.activeConnections}`, 'system');
                });
                
                console.log('ì„œë²„ ìƒíƒœ:', data);
            } catch (error) {
                console.error('âŒ API í˜¸ì¶œ ì‹¤íŒ¨ (ì„œë²„ ìƒíƒœ ì¡°íšŒ):', error);
                
                sessions.forEach(session => {
                    addMessageToSession(session.id, `API ì˜¤ë¥˜: ${error.message}`, 'error');
                });
            }
        }
        
        /**
         * ë¸Œë¡œë“œìºìŠ¤íŠ¸ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•˜ëŠ” í•¨ìˆ˜
         */
        async function sendBroadcast() {
            const messageInput = document.getElementById('broadcastMessage');
            const message = messageInput.value.trim();
            
            if (!message) {
                console.warn('âš ï¸ ë¸Œë¡œë“œìºìŠ¤íŠ¸ ë©”ì‹œì§€ê°€ ë¹„ì–´ìˆìŒ');
                alert('ë¸Œë¡œë“œìºìŠ¤íŠ¸ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            try {
                console.log('ğŸ“¡ API í˜¸ì¶œ: ë¸Œë¡œë“œìºìŠ¤íŠ¸ ë©”ì‹œì§€ ì „ì†¡:', message);
                
                const response = await fetch('/api/websocket/broadcast', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: message })
                });
                
                const data = await response.json();
                
                console.log('ğŸ“¡ ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì „ì†¡ ê²°ê³¼:', data);
                
                // ëª¨ë“  ì„¸ì…˜ì— ê²°ê³¼ í‘œì‹œ
                sessions.forEach(session => {
                    addMessageToSession(session.id, 
                        `API: ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì „ì†¡ ì™„ë£Œ - ${data.sentTo}ê°œ ì„¸ì…˜ì— ì „ì†¡`, 'system');
                });
                
                messageInput.value = '';
                console.log('ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì „ì†¡ ì™„ë£Œ:', data);
            } catch (error) {
                console.error('âŒ API í˜¸ì¶œ ì‹¤íŒ¨ (ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì „ì†¡):', error);
                
                sessions.forEach(session => {
                    addMessageToSession(session.id, `API ì˜¤ë¥˜: ${error.message}`, 'error');
                });
            }
        }

        // ========== ì´ˆê¸°í™” ==========
        
        /**
         * í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ì„¸ì…˜ë“¤ì„ ìƒì„±í•˜ëŠ” í•¨ìˆ˜
         */
        function initializeSessions() {
            console.log('ğŸš€ ì´ˆê¸° ì„¸ì…˜ ìƒì„± ì‹œì‘ (3ê°œ ì„¸ì…˜)');
            
            // ê¸°ë³¸ì ìœ¼ë¡œ 3ê°œì˜ ì„¸ì…˜ ìƒì„±
            for (let i = 0; i < 3; i++) {
                createNewSession();
            }
            
            console.log('âœ… ì´ˆê¸° ì„¸ì…˜ ìƒì„± ì™„ë£Œ');
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì‹œ ì´ˆê¸°í™” ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ Multi WebSocket Session Test í˜ì´ì§€ ë¡œë“œ ì‹œì‘');
            
            initializeSessions();
            console.log('Multi WebSocket Session Test í˜ì´ì§€ ì´ˆê¸°í™” ì™„ë£Œ');
        });
        
        // ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì…ë ¥ í•„ë“œì—ì„œ Enter í‚¤ ì²˜ë¦¬
        document.getElementById('broadcastMessage').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                console.log('âŒ¨ï¸ Enter í‚¤ë¡œ ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì „ì†¡');
                sendBroadcast();
            }
        });
    </script>
</body>
</html> 