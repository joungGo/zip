<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Test (STOMP)</title>
    <style>
        /* ì „ì²´ í˜ì´ì§€ ìŠ¤íƒ€ì¼ ì„¤ì • */
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* ì—°ê²° ìƒíƒœ í‘œì‹œ ì˜ì—­ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        
        /* WebSocket ì—°ê²°ë¨ ìƒíƒœ ìŠ¤íƒ€ì¼ (ë…¹ìƒ‰) */
        .connected {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        /* WebSocket ì—°ê²° í•´ì œë¨ ìƒíƒœ ìŠ¤íƒ€ì¼ (ë¹¨ê°„ìƒ‰) */
        .disconnected {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        /* ë©”ì‹œì§€ í‘œì‹œ ì˜ì—­ ìŠ¤íƒ€ì¼ */
        .message-area {
            height: 300px;
            border: 1px solid #ddd;
            padding: 10px;
            overflow-y: auto;  /* ì„¸ë¡œ ìŠ¤í¬ë¡¤ ìë™ ìƒì„± */
            background-color: #f9f9f9;
            margin: 10px 0;
        }
        
        /* ì…ë ¥ ê·¸ë£¹ (ë²„íŠ¼ê³¼ ì…ë ¥ í•„ë“œë¥¼ í•œ ì¤„ì— ë°°ì¹˜) */
        .input-group {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        
        /* í…ìŠ¤íŠ¸ ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ */
        input[type="text"] {
            flex: 1;  /* ë‚¨ì€ ê³µê°„ì„ ëª¨ë‘ ì°¨ì§€ */
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        /* ë²„íŠ¼ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        button {
            padding: 8px 16px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        /* ë²„íŠ¼ í˜¸ë²„ íš¨ê³¼ */
        button:hover {
            background-color: #0056b3;
        }
        
        /* ë¹„í™œì„±í™”ëœ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        
        /* REST API í…ŒìŠ¤íŠ¸ ì„¹ì…˜ êµ¬ë¶„ì„  */
        .api-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>WebSocket Test Page (STOMP)</h1>
        
        <!-- WebSocket ì—°ê²° ìƒíƒœ í‘œì‹œ ì˜ì—­ -->
        <div id="status" class="status disconnected">ì—°ê²°ë˜ì§€ ì•ŠìŒ</div>
        
        <!-- WebSocket ì—°ê²°/í•´ì œ ë²„íŠ¼ ê·¸ë£¹ -->
        <div class="input-group">
            <button id="connectBtn" onclick="connect()">ì—°ê²°</button>
            <button id="disconnectBtn" onclick="disconnect()" disabled>ì—°ê²° í•´ì œ</button>
        </div>
        
        <!-- ë©”ì‹œì§€ í‘œì‹œ ì˜ì—­ (ì†¡ìˆ˜ì‹ ëœ ëª¨ë“  ë©”ì‹œì§€ í‘œì‹œ) -->
        <div class="message-area" id="messages"></div>
        
        <!-- ë©”ì‹œì§€ ì…ë ¥ ë° ì „ì†¡ ê·¸ë£¹ -->
        <div class="input-group">
            <input type="text" id="messageInput" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." disabled>
            <button id="sendBtn" onclick="sendMessage()" disabled>ì „ì†¡</button>
        </div>
        
        <!-- REST API í…ŒìŠ¤íŠ¸ ì„¹ì…˜ -->
        <div class="api-section">
            <h3>REST API í…ŒìŠ¤íŠ¸</h3>
            <!-- API ì¡°íšŒ ë²„íŠ¼ ê·¸ë£¹ -->
            <div class="input-group">
                <button onclick="getSessionCount()">í™œì„± ì„¸ì…˜ ìˆ˜ ì¡°íšŒ</button>
                <button onclick="getStatus()">ì„œë¹„ìŠ¤ ìƒíƒœ ì¡°íšŒ</button>
            </div>
            <!-- ë¸Œë¡œë“œìºìŠ¤íŠ¸ ë©”ì‹œì§€ ì „ì†¡ ê·¸ë£¹ -->
            <div class="input-group">
                <input type="text" id="broadcastInput" placeholder="ë¸Œë¡œë“œìºìŠ¤íŠ¸ ë©”ì‹œì§€...">
                <button onclick="sendBroadcast()">ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì „ì†¡</button>
            </div>
        </div>
    </div>

    <!-- STOMP.jsì™€ SockJS CDN ì¶”ê°€ -->
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@stomp/stompjs@7/bundles/stomp.umd.min.js"></script>

    <script>
        // ========== ì „ì—­ ë³€ìˆ˜ ì„ ì–¸ ==========
        
        /**
         * STOMP í´ë¼ì´ì–¸íŠ¸ ê°ì²´
         * null: ì—°ê²°ë˜ì§€ ì•ŠìŒ, StompJs.Client ê°ì²´: ì—°ê²°ë¨
         */
        let stompClient = null;
        
        // DOM ìš”ì†Œë“¤ì„ ë³€ìˆ˜ì— ì €ì¥ (ì„±ëŠ¥ ìµœì í™” ë° ì½”ë“œ ê°€ë…ì„± í–¥ìƒ)
        const statusDiv = document.getElementById('status');           // ì—°ê²° ìƒíƒœ í‘œì‹œ ì˜ì—­
        const messagesDiv = document.getElementById('messages');       // ë©”ì‹œì§€ í‘œì‹œ ì˜ì—­
        const messageInput = document.getElementById('messageInput');   // ë©”ì‹œì§€ ì…ë ¥ í•„ë“œ
        const connectBtn = document.getElementById('connectBtn');       // ì—°ê²° ë²„íŠ¼
        const disconnectBtn = document.getElementById('disconnectBtn'); // ì—°ê²° í•´ì œ ë²„íŠ¼
        const sendBtn = document.getElementById('sendBtn');             // ë©”ì‹œì§€ ì „ì†¡ ë²„íŠ¼

        // ========== STOMP WebSocket ì—°ê²° ê´€ë¦¬ í•¨ìˆ˜ ==========
        
        /**
         * STOMP WebSocket ì„œë²„ì— ì—°ê²°ì„ ì‹œë„í•˜ëŠ” í•¨ìˆ˜
         * 
         * ì—°ê²° ê³¼ì •:
         * 1. SockJSë¥¼ ì‚¬ìš©í•˜ì—¬ WebSocket ì—°ê²° ì„¤ì •
         * 2. STOMP í´ë¼ì´ì–¸íŠ¸ ìƒì„± ë° ì„¤ì •
         * 3. ì—°ê²° ì„±ê³µ ì‹œ í† í”½ êµ¬ë… ë° UI ì—…ë°ì´íŠ¸
         */
        function connect() {
            console.log('ğŸ”— STOMP WebSocket ì—°ê²° ì‹œë„');
            
            // SockJS ì†Œì¼“ ìƒì„± (STOMP ì—”ë“œí¬ì¸íŠ¸ë¡œ ì—°ê²°)
            const socket = new SockJS('/ws');
            
            // STOMP í´ë¼ì´ì–¸íŠ¸ ìƒì„±
            stompClient = new StompJs.Client({
                webSocketFactory: () => socket,
                debug: (str) => {
                    console.log('ğŸ” STOMP Debug:', str);
                },
                onConnect: (frame) => {
                    console.log('âœ… STOMP ì—°ê²° ì„±ê³µ:', frame);
                    
                    // UI ìƒíƒœë¥¼ ì—°ê²°ë¨ìœ¼ë¡œ ì—…ë°ì´íŠ¸
                    updateStatus('ì—°ê²°ë¨', true);
                    
                    // ì—°ê²° ì„±ê³µ ë©”ì‹œì§€ë¥¼ ë©”ì‹œì§€ ì˜ì—­ì— í‘œì‹œ
                    addMessage('ì‹œìŠ¤í…œ: STOMP WebSocket ì—°ê²°ì´ ì„±ê³µí–ˆìŠµë‹ˆë‹¤.', 'system');
                    
                    // ì—°ê²° í›„ ì‚¬ìš© ê°€ëŠ¥í•œ ì»¨íŠ¸ë¡¤ë“¤ í™œì„±í™”
                    enableControls(true);
                    
                    // í† í”½ êµ¬ë… ì„¤ì •
                    subscribeToTopics();
                },
                onDisconnect: (frame) => {
                    console.log('ğŸ”Œ STOMP ì—°ê²° ì¢…ë£Œ:', frame);
                    
                    // UI ìƒíƒœë¥¼ ì—°ê²° í•´ì œë¨ìœ¼ë¡œ ì—…ë°ì´íŠ¸
                    updateStatus('ì—°ê²° í•´ì œë¨', false);
                    
                    // ì—°ê²° ì¢…ë£Œ ë©”ì‹œì§€ í‘œì‹œ
                    addMessage('ì‹œìŠ¤í…œ: STOMP WebSocket ì—°ê²°ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'system');
                    
                    // ì—°ê²° ì¢…ë£Œ í›„ ê´€ë ¨ ì»¨íŠ¸ë¡¤ë“¤ ë¹„í™œì„±í™”
                    enableControls(false);
                },
                onStompError: (frame) => {
                    console.error('âŒ STOMP ì—ëŸ¬ ë°œìƒ:', frame);
                    
                    // ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ í™”ë©´ì— í‘œì‹œ
                    addMessage('ì‹œìŠ¤í…œ: STOMP ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤ - ' + frame.body, 'error');
                }
            });
            
            // STOMP í´ë¼ì´ì–¸íŠ¸ í™œì„±í™” (ì—°ê²° ì‹œì‘)
            stompClient.activate();
        }

        /**
         * í† í”½ êµ¬ë…ì„ ì„¤ì •í•˜ëŠ” í•¨ìˆ˜
         * ì„œë²„ì—ì„œ ë³´ë‚´ëŠ” ë‹¤ì–‘í•œ ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ í•˜ê¸° ìœ„í•œ êµ¬ë… ì„¤ì •
         */
        function subscribeToTopics() {
            if (!stompClient || !stompClient.connected) {
                console.warn('âš ï¸ STOMP í´ë¼ì´ì–¸íŠ¸ê°€ ì—°ê²°ë˜ì§€ ì•ŠìŒ');
                return;
            }
            
            // 1. ì¼ë°˜ ë©”ì‹œì§€ í† í”½ êµ¬ë… (/topic/messages)
            stompClient.subscribe('/topic/messages', (message) => {
                console.log('ğŸ“¨ ì¼ë°˜ ë©”ì‹œì§€ ìˆ˜ì‹ :', message.body);
                
                try {
                    const messageData = JSON.parse(message.body);
                    addMessage('ì„œë²„: ' + messageData.content, 'received');
                } catch (e) {
                    addMessage('ì„œë²„: ' + message.body, 'received');
                }
            });
            
            // 2. í•˜íŠ¸ë¹„íŠ¸ í† í”½ êµ¬ë… (/topic/heartbeat)
            stompClient.subscribe('/topic/heartbeat', (message) => {
                console.log('ğŸ’— í•˜íŠ¸ë¹„íŠ¸ ìˆ˜ì‹ :', message.body);
                
                try {
                    const heartbeatData = JSON.parse(message.body);
                    // í•˜íŠ¸ë¹„íŠ¸ ë©”ì‹œì§€ë¥¼ ì±„íŒ…ì°½ì—ë„ í‘œì‹œ
                    const formattedMessage = `ğŸ’— ${heartbeatData.content}`;
                    addMessage(formattedMessage, 'heartbeat');
                    console.log(`ğŸ’“ í•˜íŠ¸ë¹„íŠ¸ - ì„¸ì…˜: ${heartbeatData.sessionCount}ê°œ`);
                } catch (e) {
                    // JSON íŒŒì‹± ì‹¤íŒ¨ ì‹œ ì›ë³¸ ë©”ì‹œì§€ í‘œì‹œ
                    addMessage('ğŸ’— í•˜íŠ¸ë¹„íŠ¸: ' + message.body, 'heartbeat');
                    console.log('ğŸ’“ í•˜íŠ¸ë¹„íŠ¸:', message.body);
                }
            });
            
            // 3. ì‹œìŠ¤í…œ ìƒíƒœ í† í”½ êµ¬ë… (/topic/status)
            stompClient.subscribe('/topic/status', (message) => {
                console.log('ğŸ“Š ì‹œìŠ¤í…œ ìƒíƒœ ìˆ˜ì‹ :', message.body);
                
                try {
                    console.log('ğŸ” ì›ë³¸ ì‹œìŠ¤í…œ ìƒíƒœ ë©”ì‹œì§€:', message.body);
                    
                    const statusData = JSON.parse(message.body);
                    console.log('ğŸ” íŒŒì‹±ëœ ì‹œìŠ¤í…œ ìƒíƒœ ë°ì´í„°:', statusData);
                    console.log('ğŸ” statusData.extraData:', statusData.extraData);
                    console.log('ğŸ” statusDataì˜ ëª¨ë“  í‚¤:', Object.keys(statusData));
                    
                    // STOMP ë©”ì‹œì§€ì—ì„œ extraData í•„ë“œì— ì‹¤ì œ ì‹œìŠ¤í…œ ì •ë³´ê°€ ë“¤ì–´ìˆìŒ
                    // Jacksonì´ extraDataë¥¼ extra_dataë¡œ ì§ë ¬í™”í•  ìˆ˜ ìˆìŒ
                    const systemInfo = statusData.extraData || statusData.extra_data || statusData;
                    console.log('ğŸ” systemInfo:', systemInfo);
                    console.log('ğŸ” systemInfoì˜ ëª¨ë“  í‚¤:', Object.keys(systemInfo));
                    
                    const memoryUsage = systemInfo.memory_usage_percent || systemInfo.memoryUsagePercent || 'N/A';
                    const activeSessions = systemInfo.active_sessions || systemInfo.activeSessions || 'N/A';
                    const memoryUsedMb = systemInfo.memory_used_mb || systemInfo.memoryUsedMb || 'N/A';
                    const memoryTotalMb = systemInfo.memory_total_mb || systemInfo.memoryTotalMb || 'N/A';
                    
                    console.log('ğŸ” ì¶”ì¶œëœ ê°’ë“¤:', {
                        memoryUsage, activeSessions, memoryUsedMb, memoryTotalMb
                    });
                    
                    const formattedMessage = `ğŸ“Š ì‹œìŠ¤í…œ ìƒíƒœ - ë©”ëª¨ë¦¬: ${memoryUsedMb}/${memoryTotalMb}MB (${memoryUsage}%), í™œì„± ì„¸ì…˜: ${activeSessions}ê°œ`;
                    addMessage(formattedMessage, 'system');
                } catch (e) {
                    console.error('âŒ ì‹œìŠ¤í…œ ìƒíƒœ íŒŒì‹± ì˜¤ë¥˜:', e);
                    console.error('âŒ ì›ë³¸ ë©”ì‹œì§€:', message.body);
                    addMessage('ğŸ“Š ì‹œìŠ¤í…œ ìƒíƒœ: ' + message.body, 'system');
                }
            });
            
            // 4. ì•Œë¦¼ í† í”½ êµ¬ë… (/topic/notifications)
            stompClient.subscribe('/topic/notifications', (message) => {
                console.log('ğŸ”” ì•Œë¦¼ ìˆ˜ì‹ :', message.body);
                
                try {
                    const notificationData = JSON.parse(message.body);
                    const formattedMessage = `ğŸ”” ì•Œë¦¼ [${notificationData.timestamp}] - ${notificationData.content}`;
                    addMessage(formattedMessage, 'scheduled');
                } catch (e) {
                    addMessage('ğŸ”” ì•Œë¦¼: ' + message.body, 'scheduled');
                }
            });
            
            // 5. ì‚¬ìš©ì ê°œì¸ ë©”ì‹œì§€ í† í”½ êµ¬ë… (/user/queue/messages)
            stompClient.subscribe('/user/queue/messages', (message) => {
                console.log('ğŸ‘¤ ê°œì¸ ë©”ì‹œì§€ ìˆ˜ì‹ :', message.body);
                
                try {
                    const privateData = JSON.parse(message.body);
                    addMessage('ê°œì¸ ë©”ì‹œì§€: ' + privateData.content, 'received');
                } catch (e) {
                    addMessage('ê°œì¸ ë©”ì‹œì§€: ' + message.body, 'received');
                }
            });
            
            console.log('âœ… ëª¨ë“  í† í”½ êµ¬ë… ì™„ë£Œ');
        }

        /**
         * STOMP WebSocket ì—°ê²°ì„ ì¢…ë£Œí•˜ëŠ” í•¨ìˆ˜
         * ì‚¬ìš©ìê°€ ëª…ì‹œì ìœ¼ë¡œ ì—°ê²°ì„ ëŠì„ ë•Œ í˜¸ì¶œ
         */
        function disconnect() {
            if (stompClient && stompClient.connected) {
                console.log('ğŸ”Œ STOMP WebSocket ì—°ê²° í•´ì œ ìš”ì²­');
                
                // STOMP í´ë¼ì´ì–¸íŠ¸ ë¹„í™œì„±í™” (ì—°ê²° ì¢…ë£Œ)
                stompClient.deactivate();
            }
        }

        /**
         * ì„œë²„ì— ë©”ì‹œì§€ë¥¼ ì „ì†¡í•˜ëŠ” í•¨ìˆ˜ (STOMP ë°©ì‹)
         * 
         * ì „ì†¡ ì¡°ê±´:
         * 1. ë©”ì‹œì§€ê°€ ë¹„ì–´ìˆì§€ ì•ŠìŒ
         * 2. STOMP í´ë¼ì´ì–¸íŠ¸ê°€ ì—°ê²°ëœ ìƒíƒœ
         */
        function sendMessage() {
            // ì…ë ¥ í•„ë“œì—ì„œ ë©”ì‹œì§€ ë‚´ìš© ê°€ì ¸ì˜¤ê¸° (ì•ë’¤ ê³µë°± ì œê±°)
            const message = messageInput.value.trim();
            
            // ë©”ì‹œì§€ ìœ íš¨ì„± ê²€ì‚¬ ë° STOMP ì—°ê²° ìƒíƒœ í™•ì¸
            if (message && stompClient && stompClient.connected) {
                console.log('ğŸ“¤ ì„œë²„ë¡œ ë©”ì‹œì§€ ì „ì†¡:', message);
                
                // STOMP ë©”ì‹œì§€ ì „ì†¡ (/app/message ì—”ë“œí¬ì¸íŠ¸ë¡œ)
                stompClient.publish({
                    destination: '/app/message',
                    body: JSON.stringify({
                        content: message,
                        timestamp: new Date().toISOString()
                    })
                });
                
                // ì „ì†¡í•œ ë©”ì‹œì§€ë¥¼ í™”ë©´ì— í‘œì‹œ (ì‚¬ìš©ì í™•ì¸ìš©)
                addMessage('ë‚˜: ' + message, 'sent');
                
                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                messageInput.value = '';
            } else {
                console.warn('âš ï¸ ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨: ì—°ê²°ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ë©”ì‹œì§€ê°€ ë¹„ì–´ìˆìŒ');
            }
        }

        // ========== UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ==========
        
        /**
         * ì—°ê²° ìƒíƒœ í‘œì‹œë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
         * @param {string} text - í‘œì‹œí•  ìƒíƒœ í…ìŠ¤íŠ¸
         * @param {boolean} connected - ì—°ê²° ì—¬ë¶€ (true: ì—°ê²°ë¨, false: ì—°ê²° ì•ˆë¨)
         */
        function updateStatus(text, connected) {
            // ìƒíƒœ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            statusDiv.textContent = text;
            
            // ì—°ê²° ìƒíƒœì— ë”°ë¥¸ CSS í´ë˜ìŠ¤ ì ìš©
            statusDiv.className = 'status ' + (connected ? 'connected' : 'disconnected');
        }

        /**
         * ì—°ê²° ìƒíƒœì— ë”°ë¼ UI ì»¨íŠ¸ë¡¤ë“¤ì˜ í™œì„±í™”/ë¹„í™œì„±í™”ë¥¼ ì œì–´í•˜ëŠ” í•¨ìˆ˜
         * @param {boolean} connected - ì—°ê²° ì—¬ë¶€
         */
        function enableControls(connected) {
            // ì—°ê²° ë²„íŠ¼: ì—°ê²°ë˜ì§€ ì•Šì•˜ì„ ë•Œë§Œ í™œì„±í™”
            connectBtn.disabled = connected;
            
            // ì—°ê²° í•´ì œ ë²„íŠ¼: ì—°ê²°ë˜ì—ˆì„ ë•Œë§Œ í™œì„±í™”
            disconnectBtn.disabled = !connected;
            
            // ë©”ì‹œì§€ ì…ë ¥ í•„ë“œ: ì—°ê²°ë˜ì—ˆì„ ë•Œë§Œ í™œì„±í™”
            messageInput.disabled = !connected;
            
            // ë©”ì‹œì§€ ì „ì†¡ ë²„íŠ¼: ì—°ê²°ë˜ì—ˆì„ ë•Œë§Œ í™œì„±í™”
            sendBtn.disabled = !connected;
        }

        /**
         * ë©”ì‹œì§€ ì˜ì—­ì— ìƒˆë¡œìš´ ë©”ì‹œì§€ë¥¼ ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜
         * @param {string} message - í‘œì‹œí•  ë©”ì‹œì§€ ë‚´ìš©
         * @param {string} type - ë©”ì‹œì§€ íƒ€ì… ('sent', 'received', 'system', 'error', 'scheduled')
         */
        function addMessage(message, type) {
            // ìƒˆë¡œìš´ ë©”ì‹œì§€ ìš”ì†Œ ìƒì„±
            const messageElement = document.createElement('div');
            
            // ì‹œê°„ ì •ë³´ì™€ í•¨ê»˜ ë©”ì‹œì§€ ë‚´ìš© ì„¤ì •
            messageElement.textContent = new Date().toLocaleTimeString() + ' - ' + message;
            messageElement.style.marginBottom = '5px';
            
            // ë©”ì‹œì§€ íƒ€ì…ì— ë”°ë¥¸ ìƒ‰ìƒ ì ìš©
            switch(type) {
                case 'sent':        // ì‚¬ìš©ìê°€ ë³´ë‚¸ ë©”ì‹œì§€ (íŒŒë€ìƒ‰)
                    messageElement.style.color = '#007bff';
                    break;
                case 'received':    // ì„œë²„ì—ì„œ ë°›ì€ ë©”ì‹œì§€ (ë…¹ìƒ‰)
                    messageElement.style.color = '#28a745';
                    break;
                case 'system':      // ì‹œìŠ¤í…œ ë©”ì‹œì§€ (íšŒìƒ‰, ì´íƒ¤ë¦­)
                    messageElement.style.color = '#6c757d';
                    messageElement.style.fontStyle = 'italic';
                    break;
                case 'error':       // ì—ëŸ¬ ë©”ì‹œì§€ (ë¹¨ê°„ìƒ‰)
                    messageElement.style.color = '#dc3545';
                    break;
                case 'scheduled':   // ìŠ¤ì¼€ì¤„ëŸ¬ ìë™ ë©”ì‹œì§€ (ì£¼í™©ìƒ‰, êµµê²Œ)
                    messageElement.style.color = '#fd7e14';
                    messageElement.style.fontWeight = 'bold';
                    messageElement.style.backgroundColor = '#fff3cd';
                    messageElement.style.padding = '5px';
                    messageElement.style.borderRadius = '3px';
                    break;
                case 'heartbeat':   // í•˜íŠ¸ë¹„íŠ¸ ë©”ì‹œì§€ (ë¶„í™ìƒ‰, ì‘ì€ í¬ê¸°)
                    messageElement.style.color = '#e91e63';
                    messageElement.style.fontSize = '0.9em';
                    messageElement.style.fontStyle = 'italic';
                    messageElement.style.backgroundColor = '#fce4ec';
                    messageElement.style.padding = '3px 5px';
                    messageElement.style.borderRadius = '3px';
                    messageElement.style.opacity = '0.8';
                    break;
            }
            
            // ë©”ì‹œì§€ ì˜ì—­ì— ìƒˆ ë©”ì‹œì§€ ì¶”ê°€
            messagesDiv.appendChild(messageElement);
            
            // ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ ì´ë™ (ìµœì‹  ë©”ì‹œì§€ê°€ ë³´ì´ë„ë¡)
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        // ========== REST API í˜¸ì¶œ í•¨ìˆ˜ ==========
        
        /**
         * í˜„ì¬ í™œì„± WebSocket ì„¸ì…˜ ìˆ˜ë¥¼ ì¡°íšŒí•˜ëŠ” REST API í˜¸ì¶œ í•¨ìˆ˜
         * GET /api/websocket/sessions/count
         */
        async function getSessionCount() {
            try {
                console.log('ğŸ” API í˜¸ì¶œ: í™œì„± ì„¸ì…˜ ìˆ˜ ì¡°íšŒ');
                
                // REST API í˜¸ì¶œ (GET ìš”ì²­)
                const response = await fetch('/api/websocket/sessions/count');
                
                // JSON ì‘ë‹µ íŒŒì‹±
                const data = await response.json();
                
                console.log('ğŸ“Š í™œì„± ì„¸ì…˜ ìˆ˜ ì¡°íšŒ ê²°ê³¼:', data);
                
                // ì¡°íšŒ ê²°ê³¼ë¥¼ ë©”ì‹œì§€ ì˜ì—­ì— í‘œì‹œ
                addMessage(`API: í™œì„± ì„¸ì…˜ ìˆ˜ - ${data.activeSessionCount}`, 'system');
            } catch (error) {
                console.error('âŒ API í˜¸ì¶œ ì‹¤íŒ¨ (ì„¸ì…˜ ìˆ˜ ì¡°íšŒ):', error);
                
                // API í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
                addMessage('API ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        /**
         * WebSocket ì„œë¹„ìŠ¤ ìƒíƒœë¥¼ ì¡°íšŒí•˜ëŠ” REST API í˜¸ì¶œ í•¨ìˆ˜
         * GET /api/websocket/status
         */
        async function getStatus() {
            try {
                console.log('ğŸ” API í˜¸ì¶œ: ì„œë¹„ìŠ¤ ìƒíƒœ ì¡°íšŒ');
                
                // REST API í˜¸ì¶œ (GET ìš”ì²­)
                const response = await fetch('/api/websocket/status');
                
                // JSON ì‘ë‹µ íŒŒì‹±
                const data = await response.json();
                
                console.log('ğŸ“Š ì„œë¹„ìŠ¤ ìƒíƒœ ì¡°íšŒ ê²°ê³¼:', data);
                
                // ì„œë¹„ìŠ¤ ìƒíƒœ ì •ë³´ë¥¼ ë©”ì‹œì§€ ì˜ì—­ì— í‘œì‹œ
                addMessage(`API: ì„œë¹„ìŠ¤ ìƒíƒœ - ${data.status}, ì—°ê²° ìˆ˜: ${data.activeConnections}`, 'system');
            } catch (error) {
                console.error('âŒ API í˜¸ì¶œ ì‹¤íŒ¨ (ì„œë¹„ìŠ¤ ìƒíƒœ ì¡°íšŒ):', error);
                
                // API í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
                addMessage('API ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        /**
         * ëª¨ë“  í™œì„± ì„¸ì…˜ì— ë¸Œë¡œë“œìºìŠ¤íŠ¸ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•˜ëŠ” REST API í˜¸ì¶œ í•¨ìˆ˜
         * POST /api/websocket/broadcast
         */
        async function sendBroadcast() {
            // ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì…ë ¥ í•„ë“œì—ì„œ ë©”ì‹œì§€ ê°€ì ¸ì˜¤ê¸°
            const message = document.getElementById('broadcastInput').value.trim();
            
            // ë©”ì‹œì§€ ìœ íš¨ì„± ê²€ì‚¬
            if (!message) {
                console.warn('âš ï¸ ë¸Œë¡œë“œìºìŠ¤íŠ¸ ë©”ì‹œì§€ê°€ ë¹„ì–´ìˆìŒ');
                alert('ë¸Œë¡œë“œìºìŠ¤íŠ¸ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }

            try {
                console.log('ğŸ“¡ API í˜¸ì¶œ: ë¸Œë¡œë“œìºìŠ¤íŠ¸ ë©”ì‹œì§€ ì „ì†¡:', message);
                
                // REST API í˜¸ì¶œ (POST ìš”ì²­)
                const response = await fetch('/api/websocket/broadcast', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',  // JSON í˜•íƒœë¡œ ì „ì†¡
                    },
                    body: JSON.stringify({ message: message })  // ë©”ì‹œì§€ë¥¼ JSONìœ¼ë¡œ ë³€í™˜
                });
                
                // JSON ì‘ë‹µ íŒŒì‹±
                const data = await response.json();
                
                console.log('ğŸ“¡ ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì „ì†¡ ê²°ê³¼:', data);
                
                // ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì „ì†¡ ê²°ê³¼ë¥¼ ë©”ì‹œì§€ ì˜ì—­ì— í‘œì‹œ
                addMessage(`API: ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì „ì†¡ ì™„ë£Œ - ${data.sentTo}ê°œ ì„¸ì…˜ì— ì „ì†¡`, 'system');
                
                // ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                document.getElementById('broadcastInput').value = '';
            } catch (error) {
                console.error('âŒ API í˜¸ì¶œ ì‹¤íŒ¨ (ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì „ì†¡):', error);
                
                // API í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
                addMessage('API ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }

        // ========== ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ==========
        
        /**
         * ë©”ì‹œì§€ ì…ë ¥ í•„ë“œì—ì„œ Enter í‚¤ ì…ë ¥ ì‹œ ë©”ì‹œì§€ ì „ì†¡
         * ì‚¬ìš©ì í¸ì˜ì„± í–¥ìƒì„ ìœ„í•œ í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
         */
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                console.log('âŒ¨ï¸ Enter í‚¤ë¡œ ë©”ì‹œì§€ ì „ì†¡');
                sendMessage();
            }
        });

        /**
         * ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì…ë ¥ í•„ë“œì—ì„œ Enter í‚¤ ì…ë ¥ ì‹œ ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì „ì†¡
         * ì‚¬ìš©ì í¸ì˜ì„± í–¥ìƒì„ ìœ„í•œ í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
         */
        document.getElementById('broadcastInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                console.log('âŒ¨ï¸ Enter í‚¤ë¡œ ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì „ì†¡');
                sendBroadcast();
            }
        });
        
        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì‹œ ì´ˆê¸°í™” ë¡œê·¸
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ STOMP WebSocket Test í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
        });
    </script>
</body>
</html> 